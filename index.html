<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Tesorer√≠a - Cuadrilla de Negritos Ni√±o Jes√∫s de Paucarbambilla</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts: Playfair Display para t√≠tulos solemnes y Inter para datos legibles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Terciopelo Azul y Oro (Colores tradicionales de la danza en Hu√°nuco) -->
    
    <!-- Application Structure Plan: 
         1. Resumen Financiero: Un panel de control (Dashboard) con indicadores clave de rendimiento (KPIs) sobre el estado de la caja de la cuadrilla.
         2. Gesti√≥n de la Hermandad: Una secci√≥n dedicada a los integrantes donde se generan links personalizados para el reporte de pagos.
         3. Libro Contable: Estructura de tabla dise√±ada para visualizar aportes aprobados y gastos pendientes.
         4. Interacciones: Generaci√≥n din√°mica de slugs para URLs y copiado r√°pido al portapapeles.
         5. Justificaci√≥n: Se elige un dise√±o "High-End" con bordes dorados para dignificar la labor de la cuadrilla y su devoci√≥n al Ni√±o Jes√∫s.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        :root {
            --color-ivory: #FAF9F3;
            --color-velvet: #0F172A;
            --color-gold-deep: #92400E;
            --color-gold-light: #F59E0B;
        }

        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--color-ivory);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2392400e' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .font-serif { font-family: 'Playfair Display', serif; }

        .gold-line {
            height: 4px;
            background: linear-gradient(90deg, #92400E 0%, #F59E0B 50%, #92400E 100%);
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 320px;
        }

        .btn-action {
            background-color: var(--color-velvet);
            transition: all 0.2s ease-in-out;
        }
        .btn-action:hover {
            transform: scale(1.02);
            filter: brightness(1.2);
        }

        .card-tradition {
            background: white;
            border: 1px solid #E5E7EB;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        .card-tradition::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--color-gold-deep);
        }

        .link-container {
            background: #F8FAFC;
            border: 1px dashed #CBD5E1;
            transition: border-color 0.3s;
        }
        .link-container:hover {
            border-color: var(--color-gold-light);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="text-slate-800">

    <!-- Encabezado Institucional -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-50">
        <div class="gold-line"></div>
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-slate-900 rounded-xl flex items-center justify-center text-3xl shadow-lg border-2 border-amber-500">
                    üé≠
                </div>
                <div>
                    <h1 class="font-serif text-xl font-black text-slate-900 leading-none">SISTEMA DE TESORER√çA</h1>
                    <p class="text-[10px] font-bold text-amber-700 uppercase tracking-[0.3em] mt-1">Ni√±o Jes√∫s de Paucarbambilla</p>
                </div>
            </div>
            
            <nav class="flex items-center gap-1 bg-slate-100 p-1 rounded-xl">
                <button onclick="router('dashboard')" class="nav-btn px-4 py-2 text-xs font-black rounded-lg transition-all bg-white shadow-sm text-slate-900">DASHBOARD</button>
                <button onclick="router('integrantes')" class="nav-btn px-4 py-2 text-xs font-black rounded-lg transition-all text-slate-500 hover:text-slate-900">INTEGRANTES</button>
                <button onclick="router('contabilidad')" class="nav-btn px-4 py-2 text-xs font-black rounded-lg transition-all text-slate-500 hover:text-slate-900">CONTABILIDAD</button>
            </nav>

            <div class="flex items-center gap-3 border-l pl-4 border-slate-200">
                <div class="text-right hidden lg:block">
                    <p class="text-xs font-black text-slate-900">CAPORAL ADMIN</p>
                    <p class="text-[9px] font-bold text-slate-400">Panel Maestro</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-amber-100 border-2 border-amber-500 flex items-center justify-center text-lg">üëë</div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-6 space-y-8 pb-20">

        <!-- SECCI√ìN INTRODUCTORIA -->
        <section class="bg-white p-8 rounded-2xl border border-slate-200 shadow-sm relative overflow-hidden">
            <div class="absolute -right-20 -top-20 text-[200px] opacity-[0.03] select-none font-serif">N</div>
            <div class="relative z-10">
                <span class="bg-amber-100 text-amber-800 text-[10px] font-black px-3 py-1 rounded-full uppercase tracking-widest">Control Centralizado</span>
                <h2 class="font-serif text-4xl font-black text-slate-900 mt-4 mb-4">Gesti√≥n de la Cuadrilla</h2>
                <p class="text-slate-600 max-w-3xl leading-relaxed text-sm md:text-base">
                    Bienvenido al portal maestro de la <strong>Cuadrilla de Negritos Ni√±o Jes√∫s de Paucarbambilla</strong>. 
                    Este sistema permite una administraci√≥n transparente de los fondos destinados a la festividad. 
                    Desde aqu√≠ podr√° supervisar los aportes de cada hermano integrante y distribuir los gastos de orquesta, vestimenta y cultos.
                </p>
            </div>
        </section>

        <!-- VISTA: DASHBOARD -->
        <div id="view-dashboard" class="view-content animate-fade space-y-8">
            <!-- KPIs Financieros -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="card-tradition p-6 rounded-2xl">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Caja Total</p>
                    <h3 class="text-2xl font-black text-slate-900 mt-1">S/. 18,420.50</h3>
                    <div class="flex items-center gap-1 text-emerald-600 text-[10px] font-bold mt-2">
                        <span>‚Üë</span> 8.5% este mes
                    </div>
                </div>
                <div class="card-tradition p-6 rounded-2xl">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Cuotas Pendientes</p>
                    <h3 class="text-2xl font-black text-amber-700 mt-1">S/. 3,150.00</h3>
                    <p class="text-[10px] text-slate-400 font-medium mt-2">12 hermanos por regularizar</p>
                </div>
                <div class="card-tradition p-6 rounded-2xl">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Gastos de Orquesta</p>
                    <h3 class="text-2xl font-black text-slate-900 mt-1">S/. 5,000.00</h3>
                    <p class="text-[10px] text-rose-600 font-bold mt-2">Liquidaci√≥n pendiente</p>
                </div>
                <div class="card-tradition p-6 rounded-2xl">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Devotos Registrados</p>
                    <h3 class="text-2xl font-black text-slate-900 mt-1">45 Miembros</h3>
                    <p class="text-[10px] text-slate-400 font-medium mt-2">Cuadrilla completa</p>
                </div>
            </div>

            <!-- Gr√°ficos de An√°lisis -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Gr√°fico de Barras -->
                <div class="lg:col-span-2 bg-white p-8 rounded-3xl border border-slate-200 shadow-sm">
                    <div class="flex justify-between items-center mb-6">
                        <h4 class="font-serif text-xl font-bold">Historial de Aportes vs Gastos</h4>
                        <select class="text-xs font-bold border-none bg-slate-50 rounded-lg p-2 outline-none">
                            <option>Periodo 2023-2024</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
                <!-- Gr√°fico de Dona -->
                <div class="bg-white p-8 rounded-3xl border border-slate-200 shadow-sm flex flex-col">
                    <h4 class="font-serif text-xl font-bold mb-6">Distribuci√≥n de Fondos</h4>
                    <div class="flex-1 flex items-center justify-center">
                        <canvas id="donutChart"></canvas>
                    </div>
                    <div class="mt-6 space-y-2">
                        <div class="flex justify-between text-xs font-bold">
                            <span class="text-slate-400">M√∫sica y Banda</span>
                            <span>45%</span>
                        </div>
                        <div class="w-full bg-slate-100 h-1.5 rounded-full overflow-hidden">
                            <div class="bg-blue-900 h-full w-[45%]"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VISTA: INTEGRANTES -->
        <div id="view-integrantes" class="view-content hidden animate-fade space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                <div>
                    <h3 class="font-serif text-3xl font-black">Registro de la Hermandad</h3>
                    <p class="text-slate-500 text-sm font-medium italic">Gesti√≥n de enlaces √∫nicos para el reporte de v√°uchers.</p>
                </div>
                <button onclick="toggleModal('modal-nuevo')" class="btn-action text-white px-6 py-3 rounded-xl font-bold text-xs shadow-lg flex items-center gap-2">
                    <span>‚ûï</span> REGISTRAR NUEVO NEGRITO
                </button>
            </div>

            <div class="bg-white rounded-3xl border border-slate-200 shadow-xl overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-slate-50 text-slate-400 text-[10px] uppercase font-black tracking-widest border-b">
                        <tr>
                            <th class="px-8 py-5">Hermano / Puesto</th>
                            <th class="px-8 py-5">Deuda Acumulada</th>
                            <th class="px-8 py-5">Enlace Personal de Pago</th>
                            <th class="px-8 py-5 text-center">Gesti√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="memberTable" class="divide-y divide-slate-100">
                        <!-- JS Din√°mico -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- VISTA: CONTABILIDAD -->
        <div id="view-contabilidad" class="view-content hidden animate-fade">
            <div class="bg-white p-20 text-center rounded-3xl border-2 border-dashed border-slate-200">
                <div class="text-6xl mb-4">üìì</div>
                <h3 class="font-serif text-2xl font-bold text-slate-400">Libro Contable Maestro</h3>
                <p class="text-slate-400 text-sm mt-2">Secci√≥n en mantenimiento. Consulte el Dashboard para ver el saldo en tiempo real.</p>
            </div>
        </div>

    </main>

    <!-- MODAL: REGISTRO DE INTEGRANTE -->
    <div id="modal-nuevo" class="fixed inset-0 bg-slate-900/60 hidden z-[60] flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white rounded-3xl max-w-md w-full p-8 shadow-2xl border-t-[10px] border-amber-600 space-y-6">
            <div class="text-center">
                <h3 class="font-serif text-2xl font-black text-slate-900">Nuevo Integrante</h3>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Inscripci√≥n en la Tesorer√≠a</p>
            </div>
            
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">Nombre y Apellidos</label>
                    <input type="text" id="inp-nombre" placeholder="Ej: Pedro Valdivia" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold focus:ring-2 focus:ring-amber-500">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">Cargo / Puesto</label>
                    <select id="inp-cargo" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold appearance-none">
                        <option>Negrito Gu√≠a</option>
                        <option>Trasgu√≠a</option>
                        <option>Negrito Pampa</option>
                        <option>Abanderado</option>
                        <option>Coro / M√∫sico</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-3 pt-4">
                <button onclick="toggleModal('modal-nuevo')" class="flex-1 py-4 bg-slate-100 text-slate-600 rounded-2xl font-black text-[10px] hover:bg-slate-200 transition">CANCELAR</button>
                <button onclick="addMember()" class="flex-[2] py-4 bg-slate-900 text-white rounded-2xl font-black text-[10px] shadow-xl hover:bg-black transition">GUARDAR Y GENERAR LINK</button>
            </div>
        </div>
    </div>

    <!-- Scripting Core -->
    <script>
        // --- ESTADO DE LA APLICACI√ìN ---
        let members = [
            { id: 1, name: 'Juan Alberto Ram√≠rez', role: 'Negrito Gu√≠a', debt: 150.00, slug: 'juan-ramirez-pauc' },
            { id: 2, name: 'Marcos Espinoza', role: 'Trasgu√≠a', debt: 0.00, slug: 'marcos-espinoza-pauc' },
            { id: 3, name: 'Luis √Ångel Torres', role: 'Abanderado', debt: 75.50, slug: 'luis-torres-pauc' }
        ];

        let activeCharts = {};

        // --- ENRUTADOR ---
        function router(viewId) {
            document.querySelectorAll('.view-content').forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            
            // Estilo de botones
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
                b.classList.add('text-slate-500');
            });
            event.target.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
            event.target.classList.remove('text-slate-500');

            if(viewId === 'dashboard') initCharts();
            if(viewId === 'integrantes') renderMembers();
        }

        // --- GR√ÅFICOS (Chart.js) ---
        function initCharts() {
            if(activeCharts.bar) activeCharts.bar.destroy();
            if(activeCharts.donut) activeCharts.donut.destroy();

            const ctxBar = document.getElementById('barChart').getContext('2d');
            activeCharts.bar = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['Set', 'Oct', 'Nov', 'Dic', 'Ene'],
                    datasets: [
                        { label: 'Ingresos (S/.)', data: [4500, 6200, 5800, 8900, 12000], backgroundColor: '#0F172A', borderRadius: 10 },
                        { label: 'Egresos (S/.)', data: [2100, 3000, 4200, 9500, 5000], backgroundColor: '#D97706', borderRadius: 10 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { font: { weight: '800', size: 10 } } } },
                    scales: { x: { grid: { display: false } }, y: { grid: { borderDash: [5,5] } } }
                }
            });

            const ctxDonut = document.getElementById('donutChart').getContext('2d');
            activeCharts.donut = new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: ['M√∫sica', 'Comida', 'Trajes', 'Otros'],
                    datasets: [{
                        data: [45, 25, 20, 10],
                        backgroundColor: ['#0F172A', '#D97706', '#94A3B8', '#E2E8F0'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- GESTI√ìN DE MIEMBROS ---
        function renderMembers() {
            const table = document.getElementById('memberTable');
            table.innerHTML = '';

            members.forEach(m => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50/50 transition-colors";
                
                const fullUrl = `https://tesoreria-paucarbambilla.app/pago/${m.slug}`;

                tr.innerHTML = `
                    <td class="px-8 py-6">
                        <p class="font-black text-slate-800 text-sm">${m.name}</p>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">${m.role}</p>
                    </td>
                    <td class="px-8 py-6">
                        <span class="font-black text-sm ${m.debt > 0 ? 'text-rose-600' : 'text-emerald-600'}">
                            S/. ${m.debt.toFixed(2)}
                        </span>
                    </td>
                    <td class="px-8 py-6">
                        <div class="link-container flex items-center justify-between gap-3 p-3 rounded-xl">
                            <span class="text-[10px] font-mono text-slate-400 truncate w-40">${fullUrl}</span>
                            <button onclick="copyLink('${fullUrl}')" class="text-[10px] font-black bg-white border border-slate-200 px-3 py-1.5 rounded-lg shadow-sm hover:bg-amber-50 active:scale-95 transition">COPIAR LINK</button>
                        </div>
                    </td>
                    <td class="px-8 py-6 text-center">
                        <button class="text-slate-300 hover:text-rose-600 transition" title="Dar de baja">üóëÔ∏è</button>
                    </td>
                `;
                table.appendChild(tr);
            });
        }

        function copyLink(url) {
            // Simulaci√≥n de copiado
            const btn = event.target;
            const original = btn.innerText;
            btn.innerText = '¬°COPIADO!';
            btn.classList.add('text-amber-700');
            
            setTimeout(() => {
                btn.innerText = original;
                btn.classList.remove('text-amber-700');
            }, 2000);
        }

        // --- L√ìGICA DE MODALES ---
        function toggleModal(id) {
            const m = document.getElementById(id);
            m.classList.toggle('hidden');
        }

        function addMember() {
            const name = document.getElementById('inp-nombre').value;
            const role = document.getElementById('inp-cargo').value;

            if(!name) return alert("Ingrese el nombre del hermano.");

            const slug = name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s+/g, '-') + '-' + Math.floor(Math.random() * 1000);

            members.push({
                id: Date.now(),
                name,
                role,
                debt: 0.00,
                slug
            });

            toggleModal('modal-nuevo');
            renderMembers();
            
            // Limpiar
            document.getElementById('inp-nombre').value = '';
        }

        // --- INICIO ---
        window.onload = () => {
            initCharts();
        };

    </script>
</body>
</html>
